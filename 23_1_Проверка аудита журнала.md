---
layout: default
title: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É–¥–∏—Ç–∞ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è journald"
permalink: /23_1_journalctl-audit-check/
---

# üßæ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É–¥–∏—Ç–∞ –∂—É—Ä–Ω–∞–ª–∞ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è journald

[![Platform](https://img.shields.io/badge/platform-Linux-lightgrey?style=flat-square&logo=linux)]()
[![Category](https://img.shields.io/badge/category-Logs%20%26%20Monitoring-blue?style=flat-square)]()
[![Tools](https://img.shields.io/badge/tools-journalctl%20|%20systemd--analyze%20|%20bash-yellow?style=flat-square)]()

–≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –∞—É–¥–∏—Ç–æ—Ä–æ–≤, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã `systemd-journald`:  
—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤, —Ä–æ—Ç–∞—Ü–∏—é, –∑–∞—â–∏—Ç—É –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∂—É—Ä–Ω–∞–ª–∞.

---

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–ª—É–∂–±—ã journald](#check-journald-status)
- [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ—Å—Ç–∞](#check-disk-usage)
- [–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ journald](#check-config)
- [–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞ —Ä–æ—Ç–∞—Ü–∏–∏](#check-rotation)
- [–ö–æ–Ω—Ç—Ä–æ–ª—å –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è](#check-overflow)
- [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ª–æ–≥–æ–≤](#check-integrity)
- [–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∏ –¥–æ—Å—Ç—É–ø–∞](#check-permissions)
- [–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤](#check-live-logging)
- [–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ journald](#check-performance)
- [–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç –∞—É–¥–∏—Ç–æ—Ä–∞](#checklist)

---

<a id="check-journald-status"></a>
## ‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–ª—É–∂–±—ã journald

–ü—Ä–æ–≤–µ—Ä–∏–º, –∑–∞–ø—É—â–µ–Ω–∞ –ª–∏ —Å–ª—É–∂–±–∞ –∏ –Ω–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫:

```bash
systemctl status systemd-journald
````

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**

* `Active: active (running)` ‚Äî —Å–ª—É–∂–±–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç;
* –Ω–µ—Ç –æ—à–∏–±–æ–∫ `Failed to start`, `corrupted` –∏–ª–∏ `no space left on device`;
* –≤—Ä–µ–º—è –∞–ø—Ç–∞–π–º–∞ journald (–æ–±—ã—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∞–ø—Ç–∞–π–º–æ–º —Å–∏—Å—Ç–µ–º—ã).

---

<a id="check-disk-usage"></a>

## üíæ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ—Å—Ç–∞

```bash
journalctl --disk-usage
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```
Archived and active journals take up 512.0M on disk.
```

üìä –≠—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–π –æ–±—ä—ë–º –∂—É—Ä–Ω–∞–ª–æ–≤ –Ω–∞ –¥–∏—Å–∫–µ.
–°—Ä–∞–≤–Ω–∏ —Å –ª–∏–º–∏—Ç–æ–º `SystemMaxUse` –≤ `/etc/systemd/journald.conf`.

---

<a id="check-config"></a>

## üß© –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ journald

```bash
systemd-analyze cat-config systemd/journald.conf
```

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–≤—Å–µ —Ç–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**, –≤–∫–ª—é—á–∞—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ.
–ü–æ–ª–µ–∑–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:

* `Storage=persistent` ‚Äî –ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫;
* `SystemMaxUse` –∏ `SystemKeepFree` –∑–∞–¥–∞–Ω—ã;
* `MaxRetentionSec` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è.

> üí° –ï—Å–ª–∏ `Storage=volatile`, —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥:
>
> ```bash
> sudo mkdir -p /var/log/journal
> sudo systemctl restart systemd-journald
> ```

---

<a id="check-rotation"></a>

## üîÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞ —Ä–æ—Ç–∞—Ü–∏–∏

–ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –æ—á–∏—Å—Ç–∫–∏ –≤—Ä—É—á–Ω—É—é:

```bash
sudo journalctl --vacuum-time=7d
```

–£–¥–∞–ª–∏—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π.
–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä:

```bash
sudo journalctl --vacuum-size=500M
```

–ü–æ–≤—Ç–æ—Ä–∏ `journalctl --disk-usage` ‚Äî —Ä–∞–∑–º–µ—Ä –¥–æ–ª–∂–µ–Ω —É–º–µ–Ω—å—à–∏—Ç—å—Å—è.

---

<a id="check-overflow"></a>

## üö´ –ö–æ–Ω—Ç—Ä–æ–ª—å –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä—å, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ –ª–∏–º–∏—Ç:

```bash
sudo systemd-analyze cat-config systemd/journald.conf | grep SystemMaxUse
```

–ï—Å–ª–∏ –ª–∏–º–∏—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç ‚Äî journald –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏.
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–∫—Ç —Ä–æ—Ç–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –ø–æ –ª–æ–≥–∞–º —Å–∞–º–æ–π —Å–ª—É–∂–±—ã:

```bash
journalctl -u systemd-journald | grep rotation -A3
```

---

<a id="check-integrity"></a>

## üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ª–æ–≥–æ–≤

–ü—Ä–æ–≤–µ—Ä–∏–º, –Ω–µ—Ç –ª–∏ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:

```bash
sudo journalctl --verify
```

–ü—Ä–∏–º–µ—Ä:

```
PASS: /var/log/journal/123abc/system.journal
```

–ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –±—ã–ª–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∏–ª–∏ —Å–±–æ–π –¥–∏—Å–∫–∞.

---

<a id="check-permissions"></a>

## üß± –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∏ –¥–æ—Å—Ç—É–ø–∞

```bash
ls -ld /var/log/journal
ls -l /var/log/journal/*/
```

–£–±–µ–¥–∏—Å—å, —á—Ç–æ:

* –≤–ª–∞–¥–µ–ª–µ—Ü ‚Äî `root`;
* –≥—Ä—É–ø–ø–∞ ‚Äî `systemd-journal`;
* –ø—Ä–∞–≤–∞: `drwxr-sr-x`.

–ï—Å–ª–∏ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —á–∏—Ç–∞—Ç—å –ª–æ–≥–∏:

```bash
sudo usermod -aG systemd-journal <username>
```

---

<a id="check-live-logging"></a>

## üì° –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤

```bash
sudo journalctl -f
```

(–∞–Ω–∞–ª–æ–≥ `tail -f`)

–í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≤—ã–∑–æ–≤–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```bash
sudo systemctl restart sshd
```

–ï—Å–ª–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ ‚Äî journald —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

<a id="check-performance"></a>

## üïì –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ journald

–ü—Ä–æ–≤–µ—Ä–∏–º, –Ω–∞—Å–∫–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä–æ journald —Å—Ç–∞—Ä—Ç—É–µ—Ç –∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω –ª–∏ —é–Ω–∏—Ç:

```bash
systemd-analyze blame | grep journal
systemd-analyze verify systemd-journald.service
```

**–í—ã–≤–æ–¥ –ø–æ–∫–∞–∂–µ—Ç:**

* –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ journald;
* –µ—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏ –≤ —é–Ω–∏—Ç–µ;
* –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ª–∏ journald –∑–∞–≥—Ä—É–∑–∫—É —Å–∏—Å—Ç–µ–º—ã.

---

<a id="checklist"></a>

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç –∞—É–¥–∏—Ç–æ—Ä–∞

| –ü—Ä–æ–≤–µ—Ä–∫–∞                 | –ö–æ–º–∞–Ω–¥–∞                                           | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç                 |
| ------------------------ | ------------------------------------------------- | ----------------------------------- |
| –°–ª—É–∂–±–∞ –∞–∫—Ç–∏–≤–Ω–∞           | `systemctl status systemd-journald`               | `active (running)`                  |
| –õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ | `journalctl --disk-usage`                         | > 0 –∏ –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–æ                |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã      | `systemd-analyze cat-config`                      | `Storage=persistent`, –ª–∏–º–∏—Ç—ã –∑–∞–¥–∞–Ω—ã |
| –†–æ—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç         | `journalctl --vacuum-time=7d`                     | –°—Ç–∞—Ä—ã–µ –ª–æ–≥–∏ —É–¥–∞–ª–µ–Ω—ã                 |
| –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞    | `journalctl --verify`                             | `PASS`                              |
| –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã  | `ls -ld /var/log/journal`                         | root:systemd-journal                |
| –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è             | `journalctl -f`                                   | –ù–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –≤–∏–¥–Ω—ã                 |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞   | `systemd-analyze verify systemd-journald.service` | –ë–µ–∑ –æ—à–∏–±–æ–∫                          |

---

üí° **–°–æ–≤–µ—Ç:**
–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞—É–¥–∏—Ç–∞ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–∞–π–ª `/home/gis-audit/journal_audit_$(hostname)_$(date +%F).log`.
